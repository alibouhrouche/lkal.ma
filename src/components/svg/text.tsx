import { Box, Editor, getDefaultColorTheme, SvgExportContext } from "tldraw";
import { ComponentShape } from "@/components/tools";
import { FONT_SIZES } from "@/components/content/shared.ts";
import SVGContainer from "@/components/svg/container.tsx";
import RichTextSVG from "@/components/svg/richtextsvg.tsx";

const HeaderPaths = {
  text: "M5.2 16q-.4 0-.8-.4-.3-.3-.5-1.2-.1-.6-.1-1.4 0-.8.1-2t.3-2.9h-.9q-.5 0-1-.1-.9 0-1.3-.4-.3-.3-.3-.9 0-.3.3-.5.2-.2.7-.2h1.8q.8 0 1.5.1h2.6q.5-.1.8-.1.4-.1.9-.1t.7.3q.2.2.2.6-.1.7-.7 1-.7.4-1.6.4H6.3q.1.3 0 .9-.2 1.6-.2 2.6-.1 1.1 0 1.7v1.1q.1.3.1.6-.1.9-1 .9Zm9.7 1q-1.5 0-2.4-.5-.9-.5-1.2-1.5-.4-.9-.4-2.1.1-.9.5-1.9.3-.9 1-1.7.6-.8 1.5-1.3.9-.4 2-.4 1.4 0 2.3.7.8.8.7 2.2 0 1-.6 1.7t-1.6 1q-1 .3-2.1.3-.6 0-1-.1t-.6-.3q0 .9.4 1.4.3.6 1.3.6t1.7-.2q.6-.2 1.1-.5.4-.3.7-.5.4-.2.7-.2.6 0 .5.8 0 .6-.6 1.2t-1.6.9q-1 .4-2.3.4Zm1-7.4q-.9 0-1.6.7-.7.6-1 1.6.2 0 .4.1h.7q1.1 0 1.8-.4.6-.4.7-1 0-1-1-1Zm5.3 8.9q-.3 0-.6-.3-.2-.2-.1-.9t.4-1.6q.4-.9.9-1.9.6-.9 1.4-1.9-.4-.3-.7-.7-.4-.3-.7-.6-.3-.3-.5-.6t-.2-.7q0-.3.2-.6t.7-.3q.3 0 .6.1.2.2.7.6.2.2.6.5.3.4.7.8.8-.8 1.5-1.3.7-.4 1.1-.6.4-.2.6-.2.5 0 .7.3.3.2.3.7 0 .4-.2.6-.2.3-.6.5-1.1.6-2 1.5.5.5 1 1.1.4.6.7 1 .4.7.5 1 .2.4.2.6-.1.4-.3.6-.2.2-.7.2-.3 0-.6-.2t-.6-.7l-.8-1q-.4-.6-.9-1.1-1.3 1.8-2.1 4.1-.2.4-.5.7-.3.3-.7.3Zm12.3-2q-1.3 0-2.1-.5-.8-.6-1.1-1.6-.3-1.1-.2-2.4.1-1 .2-1.8.1-.7.3-1.4.2-.7.2-1.5.1-.7.1-1.2-.1-.5 0-.9 0-.4.2-.6.2-.2.7-.2.7 0 1 .7.4.6.2 2.1 0 .4-.1.7-.1.4-.1.7.6-.2 1.3-.2.7-.1 1.3-.1.7 0 1.1.3.4.4.4.9 0 .3-.2.4-.1.2-.5.2-.8.1-1.5.2-.6 0-1.2.2-.6.1-1.2.3v.5q0 .3-.1.7 0 1.3.4 1.8.4.6 1.2.6.4 0 .6-.1.2-.1.3-.1.2-.1.4-.1.7 0 .6.8 0 .7-.6 1.2-.5.4-1.6.4Z",
  instruction:
    "M1.9 15.9q-.8 0-1.2-.3-.4-.4-.4-.9.1-.3.3-.5.2-.2.6-.3.8-.1 1.4-.2h1.2q-.2-.4-.1-.8 0-1.3.2-2.4.1-1.2.2-2.1v-.3q-.7 0-1.2.1t-1 .1q-.7 0-.9-.3-.3-.4-.3-.8.1-.4.3-.6.3-.3.9-.4.9-.1 2-.2T6 5.8h1.9q.9 0 1.2.2.3.2.2.7 0 .6-.5.9-.5.4-1.2.4H6.1q.1.3.1.7 0 .6-.2 1.8-.1 1.2-.2 2.7 0 .3-.1.4.4.1.9.1h1q1 0 1.2.2.3.3.3.7 0 .5-.5.8-.4.3-1.2.3-1.9 0-3.3.1t-2.2.1Zm16.4.8q-.9 0-1.4-1.3-.5-1.3-.4-3.8v-1q0-.4-.1-.6h-.1q-.3 0-.8.4-.4.4-.9 1.1-.5.8-.9 1.8-.5 1-.9 2.1-.2.6-.4.9-.3.2-.7.2-.7 0-1-.7-.3-.8-.3-1.9.1-.7.2-1.2 0-.5.1-1 .1-.4.2-.9t.2-1.2q0-.3.2-.6.2-.2.6-.2.4 0 .8.4.3.4.3 1.1-.1.2-.1.5 0 .2-.1.4.9-1.6 1.8-2.5 1-.8 2-.8t1.5.7q.5.7.5 1.8-.1 1.9 0 2.9.1 1.1.5 1.6.4.3.3.8 0 .4-.3.7-.3.3-.8.3Zm4.7.3q-.9 0-1.5-.3-.6-.2-.9-.7-.3-.4-.2-.8 0-.3.1-.5.2-.2.6-.2.2 0 .5.1.2.1.6.2.3.2.9.2.9 0 1.5-.3.6-.2 1-.8-.1-.3-.6-.5-.4-.2-.9-.3-.6-.2-1.1-.4-.6-.2-1.1-.5-.5-.3-.8-.8-.3-.4-.2-1.1 0-.9.5-1.5.4-.6 1.1-1 .6-.4 1.5-.6.8-.2 1.6-.1.8 0 1.2.4.4.5.4 1-.1.7-.8.7h-.9q-1 0-1.7.3-.6.2-1 .9.2.3.6.5.4.2 1 .3.5.2 1.1.4.6.2 1.1.4.5.3.8.8.3.4.2 1.1 0 1.1-.7 1.7-.6.7-1.7 1.1-1 .3-2.2.3Zm9.8-.5q-1.4 0-2.1-.5-.8-.6-1.1-1.6-.3-1.1-.2-2.4 0-1 .2-1.8.1-.7.3-1.4.1-.7.2-1.5.1-.7 0-1.2 0-.5.1-.9 0-.4.2-.6.1-.2.6-.2.8 0 1.1.7.3.6.2 2.1-.1.4-.1.7-.1.4-.2.7.7-.2 1.4-.2.7-.1 1.2-.1.8 0 1.2.3.4.4.4.9 0 .3-.2.4-.2.2-.5.2-.8.1-1.5.2-.6 0-1.2.2-.6.1-1.2.3 0 .3-.1.5v.7q-.1 1.3.3 1.8.4.6 1.3.6.3 0 .5-.1t.4-.1.4-.1q.7 0 .6.8 0 .7-.6 1.2-.6.4-1.6.4Zm6 0q-.5 0-.8-.5-.4-.4-.4-1.1.1-1.4.1-2.4-.1-1.1-.3-1.8-.1-.4-.1-.6-.1-.2 0-.4 0-.3.2-.5t.6-.2q.6 0 1 .4t.5 1.5q.8-1.3 1.8-2 1.1-.8 1.9-.8.6 0 .8.4.2.3.1.9 0 .3-.1.5-.2.3-.7.5-1.1.4-1.9 1.1-.7.6-1.1 1.5-.4.9-.5 2-.2.9-.4 1.2-.2.3-.7.3Zm10.7-.3q-1.1 0-1.9-.4-.8-.4-1.3-1.1-.5-.7-.8-1.5-.2-.8-.2-1.6 0-.7.2-1.3.2-.7.5-1.3 0-.2.3-.4.2-.1.5-.1.5 0 .8.3.3.4.3.9 0 .3-.1.5l-.2.6q-.1.4-.2.9 0 .6.3 1.1.2.6.7 1 .4.3.9.3.9 0 1.4-.8.6-.9.6-2.3.1-.5.1-.9-.1-.3-.1-.7.1-.4.2-.7.2-.3.7-.3.6 0 1 .6.3.6.2 1.8-.1 1.8-.6 3-.6 1.2-1.4 1.8-.9.6-1.9.6Zm9-.1q-1.2 0-2-.4-.7-.5-1.1-1.3-.4-.8-.3-1.8 0-.8.4-1.6.3-.7.9-1.3.7-.6 1.4-.9.8-.3 1.7-.3.5 0 1 .3t.4 1.1q0 .5-.2.8-.3.3-.7.3-.2 0-.3-.1l-.2-.2q-.1-.1-.3-.1-.6 0-1 .3-.5.3-.7.8-.3.5-.3 1-.1.6.3 1 .3.4 1 .4t1-.2q.4-.1.6-.3.2-.2.4-.3.2-.1.5-.1.6 0 .6.8-.1.6-.5 1.1-.4.5-1.1.7-.7.3-1.5.3Zm8.1.4q-1.4 0-2.1-.5-.8-.6-1.1-1.6-.3-1.1-.2-2.4 0-1 .2-1.8.1-.7.3-1.4.1-.7.2-1.5.1-.7.1-1.2-.1-.5 0-.9 0-.4.2-.6.2-.2.6-.2.8 0 1.1.7.3.6.2 2.1-.1.4-.1.7-.1.4-.2.7.7-.2 1.4-.2.7-.1 1.2-.1.8 0 1.2.3.4.4.4.9 0 .3-.2.4-.2.2-.5.2-.8.1-1.5.2-.6 0-1.2.2-.6.1-1.2.3v.5q-.1.3-.1.7-.1 1.3.3 1.8.4.6 1.3.6.3 0 .5-.1t.4-.1.4-.1q.7 0 .6.8 0 .7-.6 1.2-.6.4-1.6.4Zm5.9 0q-.5 0-.9-.5-.4-.4-.3-1 0-1 .1-1.6v-1.9q0-.6.4-1 .4-.5 1-.5.5 0 .8.3.3.4.3 1-.1.3-.1.8-.1.6-.1 1.3-.1.7-.2 1.3v.9q-.1.4-.3.6-.2.3-.7.3Zm.4-9.2q-.7 0-1.1-.3-.4-.4-.4-1 .1-.6.5-.9.5-.4 1.1-.4.7 0 1.1.4.3.5.3.9 0 .5-.4.9t-1.1.4ZM80 16q-1.3 0-2.2-.5-1-.5-1.4-1.3-.5-.9-.5-2 .1-.7.4-1.4.4-.6.9-1.2.5-.5 1.2-.8.6-.2 1.1-.2.4 0 .6.1h.2q1.8 0 2.7 1 1 1 .9 2.6 0 1.1-.6 2-.5.8-1.4 1.3-.9.4-1.9.4Zm-2-3.6q0 .7.5 1.1.5.5 1.4.5.8 0 1.4-.5.5-.4.5-1.2.1-.8-.3-1.2-.4-.4-1.1-.4-.4 0-.7.1-.3.2-.6.5l-.5.5q-.2.1-.5.2-.1.1-.1.4Zm15.5 4.3q-1 0-1.5-1.3t-.4-3.8v-1q0-.4-.1-.6h-.1q-.3 0-.7.4-.5.4-1 1.1l-.9 1.8q-.5 1-.8 2.1-.2.6-.5.9-.3.2-.7.2-.7 0-1-.7-.3-.8-.2-1.9 0-.7.1-1.2l.2-1q.1-.4.1-.9.1-.5.2-1.2 0-.3.2-.6.2-.2.6-.2.5 0 .8.4.3.4.3 1.1 0 .2-.1.5 0 .2-.1.4.9-1.6 1.9-2.5 1-.8 1.9-.8 1 0 1.5.7.6.7.5 1.8-.1 1.9 0 2.9.1 1.1.5 1.6.4.3.3.8 0 .4-.3.7-.3.3-.7.3Z",
  query:
    "M6.1 16.5q-1.6 0-2.7-.5-1-.4-1.7-1.1-.6-.8-.9-1.7-.2-.9-.2-1.9.1-1.2.6-2.2.4-1 1.1-1.7.6-.8 1.3-1.2.6-.4 1.1-.4.5-.4 1.2-.6.6-.2 1.2-.2 1 0 1.9.4.9.5 1.6 1.4.6.8.9 2 .4 1.1.3 2.4-.1 1.3-.7 2.4-.6 1.2-1.7 1.9.2.2.3.5.2.2.3.4.4.5.4 1 .1.4-.2.7-.2.3-.7.3-.3 0-.5-.1-.3-.1-.6-.5-.3-.3-.5-.7-.2-.3-.4-.8-.7.2-1.4.2Zm-3.3-5.1q-.1.7.2 1.4.3.7 1.1 1.1.7.5 2 .5.2 0 .5-.1-.2-.4-.4-.9-.2-.4-.5-.7-.4-.6-.2-1.1.2-.5.9-.5.5 0 .8.3.3.2.6.7l.3.6.4.8q.5-.4.8-1 .3-.6.3-1.2.1-.8-.1-1.5T9 8.5q-.4-.6-.9-1-.5-.3-1.2-.3-.6 0-1.1.4-.5.3-.9 1.1-.2.3-.4.5-.2.1-.5.1t-.5-.1q-.7 1-.7 2.2Zm14.3 4.8q-1 0-1.8-.4T14 14.7q-.6-.7-.8-1.5-.3-.8-.3-1.6.1-.7.2-1.3.2-.7.5-1.3.1-.2.3-.4.2-.1.5-.1.5 0 .8.3.4.4.3.9 0 .3-.1.5l-.2.6q-.1.4-.1.9-.1.6.2 1.1.3.6.7 1 .5.3 1 .3.8 0 1.4-.8.5-.9.6-2.3V9.4q0-.4.2-.7.2-.3.7-.3.6 0 .9.6.3.6.3 1.8-.1 1.8-.7 3-.5 1.2-1.4 1.8-.9.6-1.9.6Zm9.5.8q-1.4 0-2.3-.5-.9-.5-1.3-1.5-.4-.9-.3-2.1 0-.9.4-1.9.4-.9 1-1.7.7-.8 1.6-1.3.9-.4 2-.4 1.4 0 2.2.7.9.8.8 2.2-.1 1-.7 1.7t-1.5 1q-1 .3-2.1.3-.6 0-1-.1t-.6-.3q-.1.9.3 1.4.4.6 1.4.6 1 0 1.6-.2.7-.2 1.1-.5.5-.3.8-.5.3-.2.6-.2.6 0 .6.8 0 .6-.6 1.2t-1.7.9q-1 .4-2.3.4Zm1-7.4q-.8 0-1.5.7-.7.6-1.1 1.6.2 0 .5.1h.7q1 0 1.7-.4t.7-1q.1-1-1-1Zm6.7 6.9q-.5 0-.8-.5-.4-.4-.3-1.1v-2.4q0-1.1-.2-1.8-.2-.4-.2-.6v-.4q0-.3.2-.5t.6-.2q.6 0 1 .4t.5 1.5q.8-1.3 1.9-2 1-.8 1.8-.8.6 0 .8.4.2.3.2.9-.1.3-.2.5-.2.3-.6.5-1.2.4-1.9 1.1-.8.6-1.1 1.5-.4.9-.6 2-.2.9-.4 1.2-.2.3-.7.3Zm10.4 4q-1.9 0-2.7-.6-.9-.5-.8-1.3 0-.9.7-.9.3 0 .5.1l.4.2q.3.2.7.2.5.1 1.2.1.9 0 1.3-.5t.5-1.4v-3.2q-.6.8-1.2 1.1-.6.2-1.2.2-1.6 0-2.4-1-.8-1.1-.7-3.3.1-1.1.2-1.7.2-.6.5-.8.2-.2.5-.2.7 0 1 .4.3.3.3.9-.1.7-.2 1.3-.1.7 0 1.2 0 .5.1.8.2.3.6.3.7 0 1.1-.5.5-.6.9-1.5.3-1 .5-2.1.1-.5.3-.7.1-.1.5-.1.3 0 .6.2.4.1.6.5.2.4 0 1.1-.1.9-.1 1.6v1.3q0 .6.1 1.2 0 .6.1 1.3 0 .8-.1 1.8-.1 1.4-.6 2.3-.6.9-1.4 1.3-.9.4-1.8.4Z",
};

export default function textSVG({
  editor,
  shape,
  ctx,
}: {
  editor: Editor;
  shape: ComponentShape;
  ctx: SvgExportContext;
}) {
  const theme = getDefaultColorTheme(ctx);
  const exportBounds = new Box(0, 24, shape.props.w, shape.props.h - 24);
  const value =
    typeof shape.props.value !== "string"
      ? JSON.stringify(shape.props.value, null, " ")
      : shape.props.value;
  return (
    <SVGContainer
      editor={editor}
      shape={shape}
      ctx={ctx}
      headerPath={
        HeaderPaths[shape.props.component as keyof typeof HeaderPaths]
      }
    >
      <RichTextSVG
        fontSize={FONT_SIZES[shape.props.size]}
        font={shape.props.font}
        align="start"
        verticalAlign="start"
        html={value}
        labelColor={theme[shape.props.color].solid}
        bounds={exportBounds}
        wrap
        padding={10}
      />
    </SVGContainer>
  );
}
